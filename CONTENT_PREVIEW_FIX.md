# Content Preview Fix - Title and Summary Separation

## Changes Made

### 1. ✅ **Added Content Preview Generation (Backend)**
   - **Location**: `MODEL/api.py`
   - **Function**: `generate_content_preview()`
   - **Purpose**: Generates a 4-5 line summary from article content
   - **Logic**:
     - Takes first 4-5 paragraphs from the article
     - Limits each line to ~100 characters
     - Truncates at sentence boundaries when possible
     - Maximum total length: ~500 characters (5 lines × 100 chars)

### 2. ✅ **Updated Article Parsing (Backend)**
   - **Location**: `parse_article()` function in `MODEL/api.py`
   - **Change**: Now generates and includes `content_preview` field
   - **Result**: Every article now has:
     - `title`: Full article title
     - `content`: Full article content
     - `content_preview`: 4-5 line summary for preview

### 3. ✅ **Updated Database Schema**
   - **Location**: `MODEL/supabase_schema.sql`
   - **Change**: Added `content_preview TEXT` column to articles table
   - **Note**: For existing databases, you may need to run:
     ```sql
     ALTER TABLE articles ADD COLUMN IF NOT EXISTS content_preview TEXT;
     ```

### 4. ✅ **Updated Article Loading (Backend)**
   - **Location**: `load_articles()` function in `MODEL/api.py`
   - **Change**: 
     - Loads `content_preview` from database
     - Generates preview on-the-fly if not present (backward compatibility)

### 5. ✅ **Updated Article Saving (Backend)**
   - **Location**: `save_article()` function in `MODEL/api.py`
   - **Change**: Saves `content_preview` to Supabase along with other fields

### 6. ✅ **Updated Frontend TypeScript Interface**
   - **Location**: `src/lib/supabase.ts`
   - **Change**: Added `content_preview?: string` to `Article` interface

### 7. ✅ **Updated Frontend Display**
   - **Location**: `src/pages/Feed.tsx`
   - **Change**: 
     - Replaced `getDescription()` with `getContentPreview()`
     - Now uses `article.content_preview` instead of first paragraph
     - Falls back to first paragraph if preview not available (backward compatibility)

## How It Works

### Backend Flow:
1. Article is generated by CrewAI
2. `parse_article()` extracts title, content, images, sources
3. `generate_content_preview()` creates a 4-5 line summary from content
4. Article is saved to Supabase with both `content` and `content_preview`
5. When loading, `content_preview` is returned in API response

### Frontend Flow:
1. Articles are fetched from Supabase
2. Each article has `title` and `content_preview` fields
3. Feed displays:
   - **Title**: Full article title (unchanged)
   - **Preview**: 4-5 line summary from `content_preview` (new)

## Database Migration

If you have existing articles without `content_preview`, you can:

### Option 1: Let the backend handle it (Recommended)
- The backend automatically generates previews for old articles when loading
- New articles will have previews saved to database

### Option 2: Add column manually
Run this in Supabase SQL Editor:
```sql
ALTER TABLE articles ADD COLUMN IF NOT EXISTS content_preview TEXT;
```

### Option 3: Regenerate previews for existing articles
The backend will generate previews on-the-fly when loading, but you can also trigger regeneration by:
- Generating new articles (they'll have previews)
- Or manually updating existing articles

## Testing

### 1. Generate a New Article
```bash
POST /api/generate-article
```

Check the response - should include:
```json
{
  "article": {
    "title": "Article Title",
    "content": "Full article content...",
    "content_preview": "First 4-5 lines summary...",
    ...
  }
}
```

### 2. Check Feed Display
- Title should show full article title
- Preview should show 4-5 line summary (not just first paragraph)

### 3. Verify Database
Check Supabase - articles should have `content_preview` column populated

## Backward Compatibility

- Old articles without `content_preview` will still work
- Frontend falls back to first paragraph if preview not available
- Backend generates preview on-the-fly if missing from database

## Example

**Before:**
- Title: "Global Markets Surge as Tech Giants Announce Breakthrough"
- Preview: "Global Markets Surge as Tech Giants Announce Breakthrough. In a stunning turn of events..." (same as title start)

**After:**
- Title: "Global Markets Surge as Tech Giants Announce Breakthrough"
- Preview: "In a stunning turn of events, major technology companies have unveiled groundbreaking developments in artificial intelligence. The announcements sent shockwaves through global financial markets, with tech stocks surging to record highs. Industry leaders from Silicon Valley gathered to reveal innovations that could reshape entire sectors. Analysts predict these developments will accelerate digital transformation across multiple industries. The news comes at a critical time as markets seek stability amid economic uncertainty."

## Files Modified

1. `MODEL/api.py` - Added preview generation and updated save/load
2. `MODEL/supabase_schema.sql` - Added content_preview column
3. `src/lib/supabase.ts` - Added content_preview to interface
4. `src/pages/Feed.tsx` - Updated to use content_preview

